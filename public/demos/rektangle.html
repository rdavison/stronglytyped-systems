<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rektangle — Window Management</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600&family=Inter:wght@400;500&display=swap');
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { background: #0a0a10; color: #D3C6AA; font-family: 'Inter', sans-serif; overflow: hidden; height: 100vh; display: flex; flex-direction: column; }

  .menubar { height: 24px; background: rgba(18,18,26,0.95); display: flex; align-items: center; padding: 0 12px; gap: 16px; font-family: 'JetBrains Mono', monospace; font-size: 10px; color: #7A8478; border-bottom: 1px solid rgba(167,192,128,0.07); flex-shrink: 0; }
  .menubar .logo { font-weight: 600; color: #9B4D6A; }

  .desktop { flex: 1; position: relative; background: linear-gradient(135deg, #0a0a10 0%, #12121a 100%); overflow: hidden; }

  .window { position: absolute; border-radius: 8px; overflow: hidden; box-shadow: 0 8px 32px rgba(0,0,0,0.5); transition: all 0.4s cubic-bezier(0.22, 1, 0.36, 1); }
  .window.snapping { transition: all 0.35s cubic-bezier(0.22, 1, 0.36, 1); }
  .window.fading { transition: opacity 0.3s ease; }

  .titlebar { height: 28px; display: flex; align-items: center; padding: 0 10px; gap: 6px; }
  .dot { width: 10px; height: 10px; border-radius: 50%; }
  .dot.red { background: #E67E80; }
  .dot.yellow { background: #DBBC7F; }
  .dot.green { background: #A7C080; }
  .titlebar-text { margin-left: 8px; font-family: 'JetBrains Mono', monospace; font-size: 9px; color: rgba(211,198,170,0.5); }

  .window-body { width: 100%; height: calc(100% - 28px); }

  .carousel { position: absolute; bottom: 40px; left: 50%; transform: translateX(-50%); display: flex; gap: 12px; padding: 16px 24px; background: rgba(10,10,16,0.85); backdrop-filter: blur(16px); border-radius: 12px; border: 1px solid rgba(167,192,128,0.1); opacity: 0; transition: opacity 0.3s ease; pointer-events: none; }
  .carousel.visible { opacity: 1; }
  .carousel-item { width: 64px; height: 48px; border-radius: 6px; border: 2px solid transparent; transition: all 0.2s; display: flex; align-items: center; justify-content: center; font-family: 'JetBrains Mono', monospace; font-size: 8px; color: #7A8478; }
  .carousel-item.selected { border-color: #C4A882; box-shadow: 0 0 16px rgba(196,168,130,0.2); }
  .carousel-item.selected .carousel-label { color: #D3C6AA; }

  .controls { position: absolute; bottom: 8px; right: 12px; display: flex; gap: 6px; }
  .ctrl-btn { font-family: 'JetBrains Mono', monospace; font-size: 8px; padding: 3px 8px; background: rgba(18,18,26,0.8); border: 1px solid rgba(167,192,128,0.1); color: #7A8478; border-radius: 3px; cursor: pointer; transition: all 0.15s; }
  .ctrl-btn:hover { border-color: rgba(167,192,128,0.3); color: #D3C6AA; }
  .status { position: absolute; bottom: 8px; left: 12px; font-family: 'JetBrains Mono', monospace; font-size: 8px; color: #7A8478; }
</style>
</head>
<body>
<div class="menubar">
  <span class="logo">Rektangle</span>
  <span>File</span>
  <span>Edit</span>
  <span>Window</span>
  <span>Help</span>
</div>
<div class="desktop" id="desktop">
  <div class="carousel" id="carousel"></div>
  <div class="status" id="status">Ready</div>
  <div class="controls">
    <button class="ctrl-btn" onclick="snapAll()">Snap Grid</button>
    <button class="ctrl-btn" onclick="showCarousel()">Carousel</button>
    <button class="ctrl-btn" onclick="scatter()">Scatter</button>
  </div>
</div>

<script>
const desktop = document.getElementById('desktop');
const carouselEl = document.getElementById('carousel');
const statusEl = document.getElementById('status');

const APPS = [
  { name: 'Terminal', color: '#12121a', titleColor: '#1a1a24', bodyContent: 'terminal' },
  { name: 'Browser', color: '#161620', titleColor: '#1e1e2a', bodyContent: 'browser' },
  { name: 'Editor', color: '#141418', titleColor: '#1c1c22', bodyContent: 'editor' },
  { name: 'Music', color: '#18141a', titleColor: '#221c24', bodyContent: 'music' },
  { name: 'Notes', color: '#14161a', titleColor: '#1c1e24', bodyContent: 'notes' },
];

const SCATTER = [
  { x: 30, y: 20, w: 280, h: 200 },
  { x: 180, y: 60, w: 320, h: 220 },
  { x: 80, y: 120, w: 260, h: 180 },
  { x: 300, y: 30, w: 240, h: 190 },
  { x: 220, y: 150, w: 280, h: 160 },
];

let windows = [];
let phase = 'idle';

function createWindows() {
  windows = APPS.map((app, i) => {
    const el = document.createElement('div');
    el.className = 'window';
    el.style.zIndex = i + 1;

    const tb = document.createElement('div');
    tb.className = 'titlebar';
    tb.style.background = app.titleColor;
    tb.innerHTML = `<div class="dot red"></div><div class="dot yellow"></div><div class="dot green"></div><span class="titlebar-text">${app.name}</span>`;
    el.appendChild(tb);

    const body = document.createElement('div');
    body.className = 'window-body';
    body.style.background = app.color;

    // Simple fake content
    if (app.bodyContent === 'terminal') {
      body.innerHTML = '<div style="padding:8px;font-family:JetBrains Mono,monospace;font-size:8px;color:#7A8478;line-height:1.6">$ cargo build --release<br><span style="color:#A7C080">Compiling</span> coself v0.1.0<br><span style="color:#A7C080">Finished</span> release [optimized]<br>$ _</div>';
    } else if (app.bodyContent === 'browser') {
      body.innerHTML = '<div style="padding:4px 8px;background:rgba(167,192,128,0.04);font-family:JetBrains Mono,monospace;font-size:8px;color:#7A8478;border-bottom:1px solid rgba(167,192,128,0.07)">localhost:3000</div><div style="padding:8px;font-size:9px;color:#7A8478">stronglytyped.systems</div>';
    } else if (app.bodyContent === 'editor') {
      body.innerHTML = '<div style="padding:8px;font-family:JetBrains Mono,monospace;font-size:8px;line-height:1.8"><span style="color:#E67E80">fn</span> <span style="color:#A7C080">main</span>() {<br>&nbsp;&nbsp;<span style="color:#7FBBB3">let</span> brain = <span style="color:#DBBC7F">Brain</span>::new();<br>&nbsp;&nbsp;brain.<span style="color:#A7C080">invoke</span>(&prompt);<br>}</div>';
    } else if (app.bodyContent === 'music') {
      body.innerHTML = '<div style="padding:12px;text-align:center;font-size:9px;color:#7A8478"><div style="font-size:16px;margin-bottom:4px">&#9835;</div>Elgar — Cello Concerto<br><div style="margin-top:6px;height:3px;background:rgba(167,192,128,0.1);border-radius:2px"><div style="width:35%;height:100%;background:#9B4D6A;border-radius:2px"></div></div></div>';
    } else {
      body.innerHTML = '<div style="padding:8px;font-size:9px;color:#7A8478;line-height:1.6">Session Notes<br><span style="color:#C4A882">—</span> Deploy event runtime<br><span style="color:#C4A882">—</span> Wire WhatsApp gateway<br><span style="color:#C4A882">—</span> Update beliefs</div>';
    }

    el.appendChild(body);
    desktop.insertBefore(el, carouselEl);

    const pos = SCATTER[i];
    el.style.left = pos.x + 'px';
    el.style.top = pos.y + 'px';
    el.style.width = pos.w + 'px';
    el.style.height = pos.h + 'px';

    return { el, app, i };
  });
}

function scatter() {
  statusEl.textContent = 'Scattering...';
  windows.forEach((w, i) => {
    w.el.classList.add('snapping');
    const pos = SCATTER[i];
    w.el.style.left = pos.x + 'px';
    w.el.style.top = pos.y + 'px';
    w.el.style.width = pos.w + 'px';
    w.el.style.height = pos.h + 'px';
    w.el.style.opacity = 1;
    w.el.style.zIndex = i + 1;
  });
  setTimeout(() => {
    windows.forEach(w => w.el.classList.remove('snapping'));
    statusEl.textContent = 'Ready';
  }, 400);
}

function snapAll() {
  statusEl.textContent = 'Snapping to grid...';
  const dw = desktop.clientWidth;
  const dh = desktop.clientHeight;
  const gap = 4;

  // 2 on top, 3 on bottom
  const grid = [
    { x: gap, y: gap, w: dw/2 - gap*1.5, h: dh/2 - gap*1.5 },
    { x: dw/2 + gap/2, y: gap, w: dw/2 - gap*1.5, h: dh/2 - gap*1.5 },
    { x: gap, y: dh/2 + gap/2, w: dw/3 - gap*1.3, h: dh/2 - gap*1.5 - 20 },
    { x: dw/3 + gap/3, y: dh/2 + gap/2, w: dw/3 - gap*1.3, h: dh/2 - gap*1.5 - 20 },
    { x: 2*dw/3 + gap/3, y: dh/2 + gap/2, w: dw/3 - gap*1.3, h: dh/2 - gap*1.5 - 20 },
  ];

  windows.forEach((w, i) => {
    w.el.classList.add('snapping');
    const g = grid[i];
    w.el.style.left = g.x + 'px';
    w.el.style.top = g.y + 'px';
    w.el.style.width = g.w + 'px';
    w.el.style.height = g.h + 'px';
  });

  setTimeout(() => {
    windows.forEach(w => w.el.classList.remove('snapping'));
    statusEl.textContent = 'Grid layout active';
  }, 400);
}

function showCarousel() {
  statusEl.textContent = 'App Switcher';
  carouselEl.innerHTML = '';

  windows.forEach((w, i) => {
    const item = document.createElement('div');
    item.className = 'carousel-item';
    item.style.background = w.app.color;
    item.style.border = '2px solid rgba(167,192,128,0.1)';
    item.innerHTML = `<span class="carousel-label">${w.app.name}</span>`;
    item.onclick = () => selectFromCarousel(i);
    carouselEl.appendChild(item);
  });

  carouselEl.classList.add('visible');

  // dim all windows
  windows.forEach(w => {
    w.el.style.opacity = 0.3;
  });

  // auto-cycle selection
  let sel = 0;
  const items = carouselEl.querySelectorAll('.carousel-item');
  items[0].classList.add('selected');

  let cycleCount = 0;
  const interval = setInterval(() => {
    items[sel].classList.remove('selected');
    sel = (sel + 1) % items.length;
    items[sel].classList.add('selected');
    cycleCount++;
    if (cycleCount >= 7) {
      clearInterval(interval);
      setTimeout(() => selectFromCarousel(sel), 400);
    }
  }, 300);
}

function selectFromCarousel(idx) {
  carouselEl.classList.remove('visible');
  statusEl.textContent = `Focused: ${APPS[idx].name}`;

  windows.forEach((w, i) => {
    w.el.classList.add('fading');
    if (i === idx) {
      w.el.style.opacity = 1;
      w.el.style.zIndex = 10;
    } else {
      w.el.style.opacity = 0.5;
      w.el.style.zIndex = i + 1;
    }
  });

  setTimeout(() => {
    windows.forEach(w => {
      w.el.classList.remove('fading');
      w.el.style.opacity = 1;
    });
    statusEl.textContent = 'Ready';
  }, 1500);
}

// Auto-play loop
function autoPlay() {
  scatter();
  setTimeout(() => {
    snapAll();
    setTimeout(() => {
      showCarousel();
      setTimeout(autoPlay, 6000);
    }, 2000);
  }, 2000);
}

createWindows();
setTimeout(autoPlay, 1200);
</script>
</body>
</html>
