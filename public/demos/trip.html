<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Coself Portal — Trip Planner</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500&family=Inter:wght@300;400;500&display=swap');
  * { margin: 0; padding: 0; box-sizing: border-box; }
  :root {
    --bg: #0a0a10;
    --surface: #0c0c12;
    --border: #232332;
    --text: #d7d7e1;
    --text-muted: #828296;
    --text-dim: #46465a;
    --accent: #5a8cff;
    --healthy: #46be6e;
    --warning: #dcaa32;
    --error: #dc4646;
    --font-mono: 'JetBrains Mono', monospace;
    --font-body: 'Inter', sans-serif;
  }
  body {
    background: var(--bg);
    color: var(--text);
    font-family: var(--font-body);
    overflow: hidden;
    height: 100vh;
    width: 100vw;
  }
  canvas { display: block; }
</style>
</head>
<body>
<canvas id="map"></canvas>
<script>
const canvas = document.getElementById('map');
const ctx = canvas.getContext('2d');
let W, H, frame = 0, hoveredIdx = null;

function resize() {
  W = canvas.width = window.innerWidth;
  H = canvas.height = window.innerHeight;
}
resize();
window.addEventListener('resize', resize);

// ── Data ──
const stops = [
  { name: "London", country: "England", lat: 51.5, lon: -0.12, dates: "Mar 20-27", nights: 7, cost: 0,
    pois: [] },
  { name: "Naples", country: "Italy", lat: 40.85, lon: 14.27, dates: "Mar 28-31", nights: 3, cost: 65,
    pois: [
      { name: "Herculaneum", owner: "Alex" },
      { name: "Archaeological Museum", owner: "Both" },
      { name: "Caserta Palace", owner: "Sam" },
      { name: "Amalfi Coast", owner: "Sam" },
    ]},
  { name: "Rome", country: "Italy", lat: 41.9, lon: 12.5, dates: "Mar 31-Apr 2", nights: 2, cost: 100,
    pois: [
      { name: "Capitoline Museums", owner: "Both" },
      { name: "Ostia Antica", owner: "Alex" },
      { name: "Baths of Caracalla", owner: "Alex" },
      { name: "Colosseum", owner: "Both" },
      { name: "Via Condotti", owner: "Sam" },
    ]},
  { name: "Lugano", country: "Switzerland", lat: 46.0, lon: 8.95, dates: "Apr 2-3", nights: 1, cost: 150,
    pois: [
      { name: "Old Town", owner: "Alex" },
      { name: "Monte Bre", owner: "Both" },
    ]},
  { name: "Berlin", country: "Germany", lat: 52.52, lon: 13.4, dates: "Apr 3-5", nights: 2, cost: 85,
    pois: [
      { name: "Museum Island", owner: "Both" },
      { name: "Charlottenburg Palace", owner: "Sam" },
      { name: "KaDeWe", owner: "Sam" },
    ]},
];

const blockers = [
  { label: "Passport renewal", status: "done" },
  { label: "Schengen visa", status: "progress" },
  { label: "UK ETA", status: "done" },
  { label: "Flight bookings", status: "blocked" },
];

// Simplified Europe coastline polylines
const coastlines = [
  [[-5.5,37],[-6,38.7],[-9,38.7],[-9.5,39.5],[-8.5,41],[-9,42],[-8,43.5],[-2,43.5],[-1.5,43.3],[0,42.8],[3,43],[4.5,43.5],[5,43.3],[6.5,43.3],[7.5,43.8]],
  [[-5,48.5],[-3,48.7],[-1.5,48.6],[0,49.5],[1.5,51],[2.5,51],[4,51.5],[5,53.5],[6,53.5],[7,53.5],[8.5,54]],
  [[-5.5,50],[-3.5,50.3],[-1,50.8],[1.5,51],[1.7,52],[0.5,52.8],[0,53.3],[-0.5,53.8],[-1,54.5],[-2,55],[-3,55.5],[-5,54.5],[-5.5,53.5],[-4,52.5],[-5,51.5],[-5.5,50]],
  [[7.5,43.8],[8,44],[9.5,44.3],[10,44],[10.5,42.8],[11,42.5],[11.5,42],[12,41.8],[13,41.2],[14,40.8],[15,40.5],[16,39.5],[15.5,38.2],[16,37.5]],
  [[16,37.5],[17,39],[16.5,40.5],[16,41],[15.5,42],[14.5,42],[14,42.5],[13.5,43.5],[13,44],[12.5,44.5],[12.5,45.5],[13.5,45.8]],
  [[8.5,54],[9,54.8],[8.5,55],[10,54.5],[11,54.5],[12,54.5],[13,54.5],[14,54]],
  [[7.5,43.8],[7,45.5],[8,46.5],[9,47],[10,47.5],[12,47],[12.5,45.5]],
];

const LAT_MIN = 37, LAT_MAX = 55, LON_MIN = -6, LON_MAX = 18;
const MARGIN = 80;
const SUMMARY_H = 110;

function project(lat, lon) {
  const mapH = H - SUMMARY_H - 36;
  const w = W - MARGIN * 2;
  const h = mapH - MARGIN;
  const x = ((lon - LON_MIN) / (LON_MAX - LON_MIN)) * w + MARGIN;
  const y = ((LAT_MAX - lat) / (LAT_MAX - LAT_MIN)) * h + 36 + MARGIN * 0.5;
  return [x, y];
}

function quadBezier(p0, p1, p2, t) {
  const inv = 1 - t;
  return [
    inv * inv * p0[0] + 2 * inv * t * p1[0] + t * t * p2[0],
    inv * inv * p0[1] + 2 * inv * t * p1[1] + t * t * p2[1],
  ];
}

function ownerColor(owner) {
  if (owner === "Alex") return [100, 160, 255];
  if (owner === "Sam") return [255, 140, 180];
  return [180, 140, 255];
}

function blockerColor(s) {
  if (s === "done") return "#46be6e";
  if (s === "progress") return "#dcaa32";
  return "#dc4646";
}
function blockerLabel(s) {
  if (s === "done") return "DONE";
  if (s === "progress") return "IN PROGRESS";
  return "BLOCKED";
}

// Mouse tracking
let mouseX = -1, mouseY = -1;
canvas.addEventListener('mousemove', e => { mouseX = e.clientX; mouseY = e.clientY; });
canvas.addEventListener('mouseleave', () => { mouseX = -1; mouseY = -1; });

function draw() {
  frame++;
  const time = frame * 0.015;
  ctx.clearRect(0, 0, W, H);

  // Title
  ctx.font = '12px "JetBrains Mono"';
  ctx.fillStyle = '#46465a';
  ctx.textAlign = 'left';
  ctx.fillText('EUROPE 2026', 40, 56);
  ctx.font = '12px Inter';
  ctx.fillStyle = '#505064';
  ctx.fillText('March 28 - April 5    Alex + Sam', 160, 56);

  // Coastlines
  coastlines.forEach(poly => {
    ctx.beginPath();
    for (let i = 0; i < poly.length; i++) {
      const [x, y] = project(poly[i][1], poly[i][0]);
      if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
    }
    ctx.strokeStyle = 'rgba(40, 45, 55, 0.35)';
    ctx.lineWidth = 0.6;
    ctx.stroke();
  });

  // Project positions
  const positions = stops.map(s => project(s.lat, s.lon));

  // Route arcs
  for (let i = 0; i < stops.length - 1; i++) {
    const p0 = positions[i], p1 = positions[i + 1];
    const mid = [(p0[0] + p1[0]) / 2, (p0[1] + p1[1]) / 2];
    const dx = p1[0] - p0[0], dy = p1[1] - p0[1];
    const control = [mid[0] + dy * -0.15, mid[1] - dx * -0.15];

    // Draw arc
    for (let seg = 0; seg < 40; seg++) {
      const t0 = seg / 40, t1 = (seg + 1) / 40;
      const a = quadBezier(p0, control, p1, t0);
      const b = quadBezier(p0, control, p1, t1);
      const alpha = 35 + t0 * 40;
      ctx.beginPath();
      ctx.moveTo(a[0], a[1]);
      ctx.lineTo(b[0], b[1]);
      ctx.strokeStyle = `rgba(90, 140, 255, ${alpha / 255})`;
      ctx.lineWidth = 1.5;
      ctx.stroke();
    }

    // Animated traveling dot
    const phase = i * 0.25;
    const tRaw = ((time * 0.3 + phase) % 1.3);
    const tDot = Math.min(tRaw, 1.0);
    if (tRaw < 1.0) {
      const dot = quadBezier(p0, control, p1, tDot);
      // Glow
      ctx.beginPath();
      ctx.arc(dot[0], dot[1], 6, 0, Math.PI * 2);
      ctx.fillStyle = 'rgba(90, 140, 255, 0.15)';
      ctx.fill();
      // Core
      ctx.beginPath();
      ctx.arc(dot[0], dot[1], 3, 0, Math.PI * 2);
      ctx.fillStyle = 'rgba(140, 180, 255, 0.6)';
      ctx.fill();
    }
  }

  // City nodes + hover detection
  const breath = (Math.sin(frame * 0.025) * 0.5 + 0.5);
  hoveredIdx = null;

  for (let i = 0; i < stops.length; i++) {
    const [x, y] = positions[i];
    const s = stops[i];
    const baseR = s.nights === 0 ? 8 : 10 + s.nights * 2.5;

    const dx = mouseX - x, dy = mouseY - y;
    const dist = Math.sqrt(dx * dx + dy * dy);
    const hovered = dist < baseR + 14;
    if (hovered) hoveredIdx = i;

    const r = hovered ? baseR + 4 : baseR;

    // Outer glow
    const glowR = r + 6 + breath * 3;
    const glowA = hovered ? 0.18 : 0.07;
    ctx.beginPath();
    ctx.arc(x, y, glowR, 0, Math.PI * 2);
    ctx.fillStyle = `rgba(90, 140, 255, ${glowA})`;
    ctx.fill();

    // Core
    const coreA = hovered ? 0.86 : 0.63;
    ctx.beginPath();
    ctx.arc(x, y, r, 0, Math.PI * 2);
    ctx.fillStyle = `rgba(60, 110, 220, ${coreA})`;
    ctx.fill();

    // Ring
    ctx.beginPath();
    ctx.arc(x, y, r, 0, Math.PI * 2);
    ctx.strokeStyle = `rgba(130, 175, 255, ${hovered ? 0.78 : 0.39})`;
    ctx.lineWidth = hovered ? 2 : 1;
    ctx.stroke();

    // City name
    ctx.font = `${hovered ? 14 : 12}px Inter`;
    ctx.fillStyle = hovered ? '#d7d7e1' : '#aaaabe';
    ctx.textAlign = 'center';
    ctx.fillText(s.name, x, y - r - 10);

    // Nights badge
    if (s.nights > 0) {
      ctx.font = '9px "JetBrains Mono"';
      ctx.fillStyle = '#dcdcf0';
      ctx.fillText(`${s.nights}n`, x, y + 3);
    }

    // Date label (when not hovered)
    if (!hovered) {
      ctx.font = '8px "JetBrains Mono"';
      ctx.fillStyle = '#46465a';
      ctx.fillText(s.dates, x, y + r + 14);
    }
  }

  // Hover detail panel
  if (hoveredIdx !== null) {
    const s = stops[hoveredIdx];
    const [cx, cy] = positions[hoveredIdx];

    const pw = 320, poiCount = s.pois.length;
    const ph = 90 + poiCount * 18;
    let px = cx + 30;
    if (px + pw > W - 20) px = cx - pw - 30;
    let py = cy - ph / 2;
    py = Math.max(46, Math.min(H - SUMMARY_H - ph - 10, py));

    // Background
    ctx.fillStyle = 'rgba(16, 16, 24, 0.95)';
    ctx.strokeStyle = 'rgba(60, 90, 160, 0.8)';
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.roundRect(px, py, pw, ph, 8);
    ctx.fill();
    ctx.stroke();

    // City + country
    ctx.font = '15px Inter';
    ctx.fillStyle = '#d7d7e1';
    ctx.textAlign = 'left';
    ctx.fillText(`${s.name}, ${s.country}`, px + 14, py + 24);

    // Dates
    ctx.font = '10px "JetBrains Mono"';
    ctx.fillStyle = '#5a8cff';
    ctx.textAlign = 'right';
    ctx.fillText(s.dates, px + pw - 14, py + 24);

    // Cost
    ctx.textAlign = 'left';
    ctx.font = '9px "JetBrains Mono"';
    ctx.fillStyle = '#828296';
    const total = s.cost * s.nights * 2;
    const costText = s.cost === 0 ? 'Hotel covered by points' : `$${s.cost}/day/person    $${total} total (2 ppl, ${s.nights}n)`;
    ctx.fillText(costText, px + 14, py + 44);

    // POIs
    if (s.pois.length > 0) {
      ctx.font = '8px "JetBrains Mono"';
      ctx.fillStyle = '#46465a';
      ctx.fillText('POINTS OF INTEREST', px + 14, py + 62);

      s.pois.forEach((poi, pi) => {
        const pyy = py + 76 + pi * 18;
        const [r, g, b] = ownerColor(poi.owner);

        // Dot
        ctx.beginPath();
        ctx.arc(px + 22, pyy + 2, 3, 0, Math.PI * 2);
        ctx.fillStyle = `rgb(${r},${g},${b})`;
        ctx.fill();

        // Name
        ctx.font = '11px Inter';
        ctx.fillStyle = '#bebece';
        ctx.textAlign = 'left';
        ctx.fillText(poi.name, px + 32, pyy + 6);

        // Owner tag
        const tag = poi.owner === 'Alex' ? 'A' : poi.owner === 'Sam' ? 'S' : 'A+S';
        ctx.font = '8px "JetBrains Mono"';
        ctx.fillStyle = `rgb(${r},${g},${b})`;
        ctx.textAlign = 'right';
        ctx.fillText(tag, px + pw - 14, pyy + 6);
      });
    }
  }

  // ── Bottom Summary Panel ──
  const sy = H - SUMMARY_H;
  ctx.fillStyle = 'rgb(12, 12, 18)';
  ctx.fillRect(0, sy, W, SUMMARY_H);
  ctx.strokeStyle = '#232332';
  ctx.lineWidth = 0.5;
  ctx.beginPath();
  ctx.moveTo(0, sy);
  ctx.lineTo(W, sy);
  ctx.stroke();

  // Budget
  ctx.font = '9px "JetBrains Mono"';
  ctx.fillStyle = '#46465a';
  ctx.textAlign = 'left';
  ctx.fillText('BUDGET', 30, sy + 20);

  const totalNights = stops.reduce((s, c) => s + c.nights, 0);
  const totalCost = stops.reduce((s, c) => s + c.cost * c.nights * 2, 0);

  ctx.font = '13px Inter';
  ctx.fillStyle = '#828296';
  ctx.fillText(`${totalNights} nights total`, 30, sy + 38);
  ctx.fillStyle = '#d7d7e1';
  ctx.fillText(`$${totalCost} accommodation (excl. London)`, 30, sy + 56);

  // Per-city breakdown
  let bx = 30;
  ctx.font = '9px "JetBrains Mono"';
  ctx.fillStyle = '#46465a';
  stops.forEach(s => {
    if (s.cost === 0) return;
    const seg = s.cost * s.nights * 2;
    ctx.fillText(`${s.name}: $${seg}`, bx, sy + 78);
    bx += 130;
  });

  // Blockers
  const blkX = W - 320;
  ctx.font = '9px "JetBrains Mono"';
  ctx.fillStyle = '#46465a';
  ctx.fillText('BLOCKERS', blkX, sy + 20);

  blockers.forEach((b, i) => {
    const by = sy + 36 + i * 16;
    ctx.fillStyle = blockerColor(b.status);
    ctx.beginPath();
    ctx.arc(blkX + 6, by + 1, 3, 0, Math.PI * 2);
    ctx.fill();

    ctx.font = '10px Inter';
    ctx.fillStyle = '#828296';
    ctx.textAlign = 'left';
    ctx.fillText(b.label, blkX + 16, by + 5);

    ctx.font = '8px "JetBrains Mono"';
    ctx.fillStyle = blockerColor(b.status);
    ctx.textAlign = 'right';
    ctx.fillText(blockerLabel(b.status), W - 20, by + 5);
  });

  // Legend
  const lx = W / 2 - 100;
  ctx.font = '9px "JetBrains Mono"';
  ctx.fillStyle = '#46465a';
  ctx.textAlign = 'left';
  ctx.fillText('INTERESTS', lx, sy + 20);

  const legend = [["Alex", [100,160,255]], ["Sam", [255,140,180]], ["Both", [180,140,255]]];
  let llx = lx;
  legend.forEach(([label, [r,g,b]]) => {
    ctx.fillStyle = `rgb(${r},${g},${b})`;
    ctx.beginPath();
    ctx.arc(llx + 4, sy + 37, 4, 0, Math.PI * 2);
    ctx.fill();
    ctx.font = '10px Inter';
    ctx.fillText(label, llx + 14, sy + 41);
    llx += 75;
  });

  requestAnimationFrame(draw);
}

draw();
</script>
</body>
</html>
